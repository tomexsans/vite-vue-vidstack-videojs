var P=Object.defineProperty;var T=(s,e,t)=>e in s?P(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var r=(s,e,t)=>(T(s,typeof e!="symbol"?e+"":e,t),t);import{au as d,av as f,aw as u,ax as k,ay as I,af as c,az as l,aA as p,an as E,aB as v,aC as o}from"./index-7897b458.js";import{H}from"./provider-eb290e0d.js";class y{constructor(e,t){this.ta=e,this.ph=t,e.textTracks.onaddtrack=this.ya.bind(this),d(this.qh.bind(this))}ya(e){const t=e.track;if(!t||A(this.ta,t))return;const i=new f({id:t.id,kind:t.kind,label:t.label,language:t.language,type:"vtt"});i[u]={track:t},i[k]=2,i[I]=!0;let n=0;const h=g=>{if(t.cues)for(let a=n;a<t.cues.length;a++)i.addCue(t.cues[a],g),n++};h(e),t.oncuechange=h,this.ph.textTracks.add(i,e),i.setMode(t.mode,e)}qh(){var e;this.ta.textTracks.onaddtrack=null;for(const t of this.ph.textTracks){const i=(e=t[u])==null?void 0:e.track;i!=null&&i.oncuechange&&(i.oncuechange=null)}}}function A(s,e){return Array.from(s.children).find(t=>t.track===e)}class O{constructor(e,t){r(this,"Pc",(e,t)=>{this.n.delegate.U("picture-in-picture-change",{detail:e,trigger:t})});this.ta=e,this.n=t,c(this.ta,"enterpictureinpicture",this.Fh.bind(this)),c(this.ta,"leavepictureinpicture",this.Gh.bind(this))}get active(){return document.pictureInPictureElement===this.ta}get supported(){return l(this.ta)}async enter(){return this.ta.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}Fh(e){this.Pc(!0,e)}Gh(e){this.Pc(!1,e)}}class x{constructor(e,t){r(this,"Oa","inline");this.ta=e,this.n=t,c(this.ta,"webkitpresentationmodechanged",this.Kh.bind(this))}get Jh(){return p(this.ta)}async Ih(e){this.Oa!==e&&this.ta.webkitSetPresentationMode(e)}Kh(){var t;const e=this.Oa;this.Oa=this.ta.webkitPresentationMode,(t=this.n.player)==null||t.dispatchEvent(new E("video-presentation-change",{detail:this.Oa,trigger:event})),["fullscreen","picture-in-picture"].forEach(i=>{(this.Oa===i||e===i)&&this.n.delegate.U(`${i}-change`,{detail:this.Oa===i,trigger:event})})}}class w{constructor(e){this.Hh=e}get active(){return this.Hh.Oa==="fullscreen"}get supported(){return this.Hh.Jh}async enter(){this.Hh.Ih("fullscreen")}async exit(){this.Hh.Ih("inline")}}class b{constructor(e){this.Hh=e}get active(){return this.Hh.Oa==="picture-in-picture"}get supported(){return this.Hh.Jh}async enter(){this.Hh.Ih("picture-in-picture")}async exit(){this.Hh.Ih("inline")}}class C extends H{constructor(t,i){super(t);r(this,"$$PROVIDER_TYPE","VIDEO");r(this,"fullscreen");r(this,"pictureInPicture");if(p(t)){const n=new x(t,i);this.fullscreen=new w(n),this.pictureInPicture=new b(n)}else l(t)&&(this.pictureInPicture=new O(t,i))}get type(){return"video"}setup(t){super.setup(t),v(this.video)&&new y(this.video,t),t.textRenderers[o](this.video),d(()=>{t.textRenderers[o](null)}),this.type==="video"&&t.delegate.U("provider-setup",{detail:this})}get video(){return this.n}}export{C as VideoProvider};
