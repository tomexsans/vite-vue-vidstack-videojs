{
  "version": 3,
  "sources": ["../../vidstack/dist/dev/providers/hls/lib-loader.js", "../../vidstack/dist/dev/providers/hls/provider.js"],
  "sourcesContent": ["import { isUndefined, isString, DOMEvent, isFunction } from 'maverick.js/std';\nimport { R as coerceToError, U as loadScript } from '../../media-core.js';\n\nclass HLSLibLoader {\n  constructor(_lib, _context, _callback) {\n    this._lib = _lib;\n    this._context = _context;\n    this._callback = _callback;\n    this._startLoading();\n  }\n  async _startLoading() {\n    this._context.logger?.info(\"\\u{1F3D7}\\uFE0F Loading HLS Library\");\n    const callbacks = {\n      onLoadStart: this._onLoadStart.bind(this),\n      onLoaded: this._onLoaded.bind(this),\n      onLoadError: this._onLoadError.bind(this)\n    };\n    let ctor = await loadHLSScript(this._lib, callbacks);\n    if (isUndefined(ctor) && !isString(this._lib))\n      ctor = await importHLS(this._lib, callbacks);\n    if (!ctor)\n      return null;\n    if (!ctor.isSupported()) {\n      const message = \"[vidstack]: `hls.js` is not supported in this environment\";\n      this._context.logger?.error(message);\n      this._context.player.dispatchEvent(new DOMEvent(\"hls-unsupported\"));\n      this._context.delegate._dispatch(\"error\", { detail: { message, code: 4 } });\n      return null;\n    }\n    return ctor;\n  }\n  _onLoadStart() {\n    {\n      this._context.logger?.infoGroup(\"Starting to load `hls.js`\").labelledLog(\"URL\", this._lib).dispatch();\n    }\n    this._context.player.dispatchEvent(new DOMEvent(\"hls-lib-load-start\"));\n  }\n  _onLoaded(ctor) {\n    {\n      this._context.logger?.infoGroup(\"Loaded `hls.js`\").labelledLog(\"Library\", this._lib).labelledLog(\"Constructor\", ctor).dispatch();\n    }\n    this._context.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-loaded\", {\n        detail: ctor\n      })\n    );\n    this._callback(ctor);\n  }\n  _onLoadError(e) {\n    const error = coerceToError(e);\n    {\n      this._context.logger?.errorGroup(\"Failed to load `hls.js`\").labelledLog(\"Library\", this._lib).labelledLog(\"Error\", e).dispatch();\n    }\n    this._context.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-load-error\", {\n        detail: error\n      })\n    );\n    this._context.delegate._dispatch(\"error\", {\n      detail: { message: error.message, code: 4 }\n    });\n  }\n}\nasync function importHLS(loader, callbacks = {}) {\n  if (isUndefined(loader))\n    return void 0;\n  callbacks.onLoadStart?.();\n  if (loader.prototype && loader.prototype !== Function) {\n    callbacks.onLoaded?.(loader);\n    return loader;\n  }\n  try {\n    const ctor = (await loader())?.default;\n    if (ctor && !!ctor.isSupported) {\n      callbacks.onLoaded?.(ctor);\n    } else {\n      throw Error(\n        true ? \"[vidstack] failed importing `hls.js`. Dynamic import returned invalid constructor.\" : \"\"\n      );\n    }\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\nasync function loadHLSScript(src, callbacks = {}) {\n  if (!isString(src))\n    return void 0;\n  callbacks.onLoadStart?.();\n  try {\n    await loadScript(src);\n    if (!isFunction(window.Hls)) {\n      throw Error(\n        true ? \"[vidstack] failed loading `hls.js`. Could not find a valid `Hls` constructor on window\" : \"\"\n      );\n    }\n    const ctor = window.Hls;\n    callbacks.onLoaded?.(ctor);\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\n\nexport { HLSLibLoader as H };\n", "import { peek } from 'maverick.js';\nimport { isString } from 'maverick.js/std';\nimport { W as isHLSSupported, p as preconnect } from '../../media-core.js';\nimport { VideoProvider } from '../video/provider.js';\nimport { H as HLSController } from './hls.js';\nimport { H as HLSLibLoader } from './lib-loader.js';\nimport 'maverick.js/element';\nimport '../type-check.js';\nimport '../audio/loader.js';\nimport 'maverick.js/dom';\nimport './loader.js';\nimport '../video/loader.js';\nimport '../html/provider.js';\nimport '../html/htmlâ€“media-events.js';\nimport '../../media-ui.js';\nimport '../../icons/icon.js';\nimport 'media-captions';\nimport '../html/native-audio-tracks.js';\nimport '../video/native-hls-text-tracks.js';\nimport '../video/picture-in-picture.js';\nimport '../video/presentation/video-presentation.js';\n\nconst JS_DELIVR_CDN = \"https://cdn.jsdelivr.net\";\nclass HLSProvider extends VideoProvider {\n  $$PROVIDER_TYPE = \"HLS\";\n  _ctor = null;\n  _controller = new HLSController(this.video);\n  /**\n   * The `hls.js` constructor.\n   */\n  get ctor() {\n    return this._ctor;\n  }\n  /**\n   * The current `hls.js` instance.\n   */\n  get instance() {\n    return this._controller.instance;\n  }\n  /**\n   * Whether `hls.js` is supported in this environment.\n   */\n  static supported = isHLSSupported();\n  get type() {\n    return \"hls\";\n  }\n  get canLiveSync() {\n    return true;\n  }\n  _library = `${JS_DELIVR_CDN}/npm/hls.js@^1.0.0/dist/hls${\".js\" }`;\n  /**\n   * The `hls.js` configuration object.\n   *\n   * @see {@link https://github.com/video-dev/hls.js/blob/master/docs/API.md#fine-tuning}\n   */\n  get config() {\n    return this._controller._config;\n  }\n  set config(config) {\n    this._controller._config = config;\n  }\n  /**\n   * The `hls.js` constructor (supports dynamic imports) or a URL of where it can be found.\n   *\n   * @defaultValue `https://cdn.jsdelivr.net/npm/hls.js@^1.0.0/dist/hls.min.js`\n   */\n  get library() {\n    return this._library;\n  }\n  set library(library) {\n    this._library = library;\n  }\n  preconnect() {\n    if (!isString(this._library))\n      return;\n    preconnect(this._library);\n  }\n  setup(context) {\n    super.setup(context);\n    new HLSLibLoader(this._library, context, (ctor) => {\n      this._ctor = ctor;\n      this._controller.setup(ctor, context);\n      context.delegate._dispatch(\"provider-setup\", { detail: this });\n      const src = peek(context.$store.source);\n      if (src)\n        this.loadSource(src);\n    });\n  }\n  async loadSource({ src }) {\n    if (!isString(src))\n      return;\n    this._controller.instance?.loadSource(src);\n  }\n  /**\n   * The given callback is invoked when a new `hls.js` instance is created and right before it's\n   * attached to media.\n   */\n  onInstance(callback) {\n    const instance = this._controller.instance;\n    if (instance)\n      callback(instance);\n    this._controller._callbacks.add(callback);\n    return () => this._controller._callbacks.delete(callback);\n  }\n  destroy() {\n    this._controller._destroy();\n  }\n}\n\nexport { HLSProvider };\n"],
  "mappings": "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",
  "names": []
}
